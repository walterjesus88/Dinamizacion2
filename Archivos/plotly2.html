<!DOCTYPE html>
<html>
<head>
  <!-- Incluir la biblioteca de Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <!-- Incluir la biblioteca de SheetJS -->
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js'></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
  <!-- Elemento div donde se mostrará la visualización -->
  <div id="visualization"></div>
  
  <!-- <div id="Dinamizado"></div>  -->
  <div id="line"></div>

  <div id="table"></div>

  <!-- <div id="myPlot"></div> -->

  <!-- <div class="container">s
    <div class="row">
      <div class="col-md-4" id="myDiv">
        Column
      </div>
      <div class="col-md-4" id="Dinamizado">
        Column
      </div>   
    </div>
  </div> -->

  
  <!-- Input para seleccionar el archivo de Excel -->
  <input type="file" id="fileInput" accept=".xlsx">


  <script>
    // Función para leer el archivo de Excel
    function readExcelFile(file) {
      var reader = new FileReader();
      reader.onload = function(e) {
        var data = new Uint8Array(e.target.result);
        var workbook = XLSX.read(data, {type: 'array'});
        var sheetName = workbook.SheetNames[0];
        var sheet = workbook.Sheets[sheetName];
        var jsonData = XLSX.utils.sheet_to_json(sheet, {header: 1});
        console.log(jsonData)
        // Crear la visualización utilizando los datos leídos
        createVisualization(jsonData);
      };
      reader.readAsArrayBuffer(file);
    }

    // Función para crear la visualización con Plotly.js
    function createVisualization(data) {
      var xValues = data[0]; // Valores en el eje x
      var yValues = data[1]; // Valores en el eje y

      var trace = {
        x: xValues,
        y: yValues,
        mode: 'markers',
        type: 'scatter'
      };

      var layout = {
        title: 'Visualización de datos de Excel',
        xaxis: {title: 'Eje X'},
        yaxis: {title: 'Eje Y'}
      };

      var plotData = [trace];

      // Crear la visualización con Plotly.js
      Plotly.newPlot('visualization', plotData, layout);
    }

    // Manejar el evento de cambio de archivo
    function handleFileChange(event) {
      var file = event.target.files[0];
      readExcelFile(file);
    }

    // Escuchar el evento de cambio de archivo
    document.getElementById('fileInput').addEventListener('change', handleFileChange);


    // var data = [{
    //   values: [19, 26, 55],
    //   labels: ['Residential', 'Non-Residential', 'Utility'],
    //   type: 'pie'
    // }];

    // var layout = {
    //   height: 400,
    //   width: 300
    // };

    // Plotly.newPlot('myDiv', data, layout);

    // var data = [{
    //   values: [0.19, 0.26, 0.55],
    //   labels: ['Destacados', 'Más vistos', 'Partidos'],
    //   type: 'pie'
    // }];

    // var layout = {
    //   height: 400,
    //   width: 200
    // };

    // Plotly.newPlot('Dinamizado', data, layout);


    d3.csv("https://raw.githubusercontent.com/plotly/datasets/master/Mining-BTC-180.csv", function(err, rows){

      function unpack(rows, key) {
      return rows.map(function(row) { return row[key]; });
      }

      // header values
      var headerNames = d3.keys(rows[0]);
      var headerValues = [headerNames[1],headerNames[2],
                          headerNames[3],headerNames[4]];

      // cell values
      var cellValues = [];
      for (i = 0; i < headerValues.length; i++) {
        cellValue = unpack(rows, headerValues[i]);
        cellValues[i] = cellValue;
      }

      // clean date
      for (i = 0; i < cellValues[0].length; i++) {
      var dateValue = cellValues[0][i].split(' ')[0]
      cellValues[0][i] = dateValue
      }

      // create table
      var table = {
        type: 'table',
        columnwidth: [150,200,200,150],
        columnorder: [0,1,2,3],
        header: {
          values: headerValues,
          align: "center",
          line: {width: 1, color: 'rgb(50, 50, 50)'},
          fill: {color: ['rgb(235, 100, 230)']},
          font: {family: "Arial", size: 11, color: "white"}
        },
        cells: {
          values: cellValues,
          align: ["center", "center"],
          line: {color: "black", width: 1},
          fill: {color: ['rgb(235, 193, 238)', 'rgba(228, 222, 249, 0.65)']},
          font: {family: "Arial", size: 10, color: ["black"]}
        },
        xaxis: 'x',
        yaxis: 'y',
        domain: {x: [0,0.4], y: [0,1]}
      }

      // create 1st plot
      var trace1 = {
        x: unpack(rows, 'Date'),
        y: unpack(rows, 'Hash-rate'),
        xaxis: 'x1',
        yaxis: 'y1',
        mode: 'lines',
        line: {width: 2, color: '#9748a1'},
        name: 'hash-rate-TH/s'
      }
      // create 2nd plot
      var trace2 = {
        x: unpack(rows, 'Date'),
        y: unpack(rows, 'Mining-revenue-USD'),
        xaxis: 'x2',
        yaxis: 'y2',
        mode: 'lines',
        line: {width: 2, color: '#b04553'},
        name: 'Mining-revenue-USD'
      }

      // create 3rd plot
      var trace3 = {
        x: unpack(rows, 'Date'),
        y: unpack(rows, 'Transaction-fees-BTC'),
        xaxis: 'x3',
        yaxis: 'y3',
        mode: 'lines',
        line: {width: 2, color: '#af7bbd'},
        name: 'Transaction-fees-BTC'
      }

      var data = [table,trace1,trace2,trace3]

      // define subplot axes
      var axis = {
        showline: true,
        zeroline: false,
        showgrid: true,
        mirror:true,
        ticklen: 4,
        gridcolor: '#ffffff',
        tickfont: {size: 10},
      }

      var axis1 = {domain: [0.5, 1], anchor: 'y1', showticklabels: false}
      var axis2 = {domain: [0.5, 1], anchor: 'y2', showticklabels: false}
      var axis3 = {domain: [0.5, 1], anchor: 'y3'}
      var axis4 = {domain: [0.66, 0.98], anchor: 'x1', hoverformat: '.2f'}
      var axis5 = {domain: [0.34, 0.64], anchor: 'x2', tickprefix: '$', hoverformat: '.2f'}
      var axis6 = {domain: [0.0, 0.32], anchor: 'x3', tickprefix: '\u20BF', hoverformat: '.2f'}

      // define layout
      var layout = {
        title: "Bitcoin mining stats for 180 days",
        plot_bgcolor: 'rgba(228, 222, 249, 0.65)',
        showlegend: false,
        xaxis1: Object.assign(axis1,axis),
        xaxis2: Object.assign(axis2,axis),
        xaxis3: Object.assign(axis3,axis),
        yaxis1: Object.assign(axis4,axis),
        yaxis2: Object.assign(axis5,axis),
        yaxis3: Object.assign(axis6,axis)
      }

      Plotly.newPlot('table', data, layout);

      });



      Papa.parse("datos.csv", {
      download: true,
      complete: function(results) {
        var data = results.data;
        console.log(data)
        // Manipulación de datos y creación del gráfico con Plotly.js
        var trace = {
          x: data.map(row => row[0]), // Asignar la primera columna del CSV al eje x
          y: data.map(row => row[1]), // Asignar la segunda columna del CSV al eje y
          type: 'scatter'
        };

        var layout = {
          title: 'Gráfico de datos CSV',
          xaxis: { title: 'Eje X' },
          yaxis: { title: 'Eje Y' }
        };

        Plotly.newPlot('myPlot', [trace], layout);
      }
    });


// var trace1 = {
//   x: [1, 2, 3, 4, 5],
//   y: [1, 3, 2, 4, 2],
//   type: 'scatter'
// };

// var data = [trace1];

// var layout = {
//   title: 'Gráfico con cuadrícula personalizada',
//   xaxis: {
//     title: 'Eje X',
//     gridcolor: 'lightgray',     // Color de las líneas de la cuadrícula en el eje X
//     gridwidth: 1                // Ancho de las líneas de la cuadrícula en el eje X
//   },
//   yaxis: {
//     title: 'Eje Y',
//     gridcolor: 'lightgray',     // Color de las líneas de la cuadrícula en el eje Y
//     gridwidth: 1                // Ancho de las líneas de la cuadrícula en el eje Y
//   }
// };

// Plotly.newPlot('myPlot', data, layout);


var trace1 = {
  x: [1, 2, 3, 4],
  y: [10, 15, 13, 17],
  type: 'scatter'
};

var trace2 = {
  x: [1, 2, 3, 4],
  y: [16, 5, 11, 9],
  type: 'scatter'
};

var data = [trace1, trace2];

Plotly.newPlot('line', data);


  </script>


</body>
</html>
